<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hitaishi Matrimony - User Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body style="margin: 0; padding: 0; font-family: 'Arial', sans-serif; color: #333; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh;">

<!-- Header -->
<div style="background: linear-gradient(135deg, #ff3366, #ff4b2b); color: white; padding: 15px 0; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); position: fixed; width: 100%; top: 0; z-index: 1000;">
    <div style="max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 0 20px;">
        <div>
            <h1 style="font-size: 1.8rem; margin-bottom: 5px;">Hitaishi Matrimony</h1>
            <p style="font-size: 0.9rem; opacity: 0.9;">Find Your Perfect Life Partner</p>
        </div>
        <div style="display: flex; align-items: center; gap: 15px;">
            <a href="search.html" style="background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid white; padding: 10px 20px; border-radius: 25px; text-decoration: none; font-weight: 600; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 8px;">
                <i class="fas fa-search"></i> Find Matches
            </a>
            <button id="logoutBtn" style="background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid white; padding: 10px 20px; border-radius: 25px; text-decoration: none; font-weight: 600; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 8px; cursor: pointer;">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
    </div>
</div>

<!-- Main Container -->
<div style="max-width: 1200px; margin: 100px auto 40px; display: grid; grid-template-columns: 300px 1fr; gap: 20px; padding: 0 20px;">

    <!-- Sidebar -->
    <div style="background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); padding: 20px; height: fit-content; position: sticky; top: 120px;">
        <div style="text-align: center; padding-bottom: 20px; border-bottom: 1px solid #ddd; margin-bottom: 20px;">
            <img id="profilePhoto" src="" alt="Profile Photo" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid #ff3366; margin-bottom: 15px;">
            <h2 id="userName" style="font-size: 1.5rem; color: #333; margin-bottom: 5px;">User Name</h2>
            <p id="userId" style="color: #666; font-size: 0.9rem; margin-bottom: 15px;">ID: Loading...</p>
            
            <div style="margin-top: 15px;">
                <div style="height: 8px; background: #f5f5f5; border-radius: 4px; margin-bottom: 5px; overflow: hidden;">
                    <div id="profileProgress" style="height: 100%; background: #ff3366; border-radius: 4px; width: 75%;"></div>
                </div>
                <p id="completionText" style="font-size: 0.8rem; color: #666;">Profile Loading...</p>
            </div>
        </div>
        
        <ul style="list-style: none;">
            <li style="margin-bottom: 10px;">
                <a href="#" class="nav-link active" data-section="dashboard" style="display: flex; align-items: center; gap: 10px; padding: 12px 15px; border-radius: 10px; color: #333; text-decoration: none; transition: all 0.3s ease; background: rgba(255, 51, 102, 0.1); color: #ff3366;">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
            </li>
            <li style="margin-bottom: 10px;">
                <a href="#" class="nav-link" data-section="profile" style="display: flex; align-items: center; gap: 10px; padding: 12px 15px; border-radius: 10px; color: #333; text-decoration: none; transition: all 0.3s ease;">
                    <i class="fas fa-user-edit"></i> Edit Profile
                </a>
            </li>
            <li style="margin-bottom: 10px;">
                <a href="#" class="nav-link" data-section="photos" style="display: flex; align-items: center; gap: 10px; padding: 12px 15px; border-radius: 10px; color: #333; text-decoration: none; transition: all 0.3s ease;">
                    <i class="fas fa-images"></i> My Photos
                </a>
            </li>
            <li style="margin-bottom: 10px;">
                <a href="#" class="nav-link" data-section="matches" style="display: flex; align-items: center; gap: 10px; padding: 12px 15px; border-radius: 10px; color: #333; text-decoration: none; transition: all 0.3s ease;">
                    <i class="fas fa-heart"></i> Match Suggestions
                </a>
            </li>
            <li style="margin-bottom: 10px;">
                <a href="#" class="nav-link" data-section="messages" style="display: flex; align-items: center; gap: 10px; padding: 12px 15px; border-radius: 10px; color: #333; text-decoration: none; transition: all 0.3s ease;">
                    <i class="fas fa-envelope"></i> Messages
                </a>
            </li>
            <li style="margin-bottom: 10px;">
                <a href="#" class="nav-link" data-section="settings" style="display: flex; align-items: center; gap: 10px; padding: 12px 15px; border-radius: 10px; color: #333; text-decoration: none; transition: all 0.3s ease;">
                    <i class="fas fa-cog"></i> Settings
                </a>
            </li>
        </ul>
    </div>

    <!-- Dashboard Content -->
    <div style="background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); padding: 30px; min-height: 500px;">
        <!-- Dashboard Overview -->
        <div id="dashboard" class="dashboard-section" style="display: block;">
            <h2 style="color: #ff3366; margin-bottom: 20px; font-size: 1.8rem; border-bottom: 2px solid #ddd; padding-bottom: 10px;">Dashboard Overview</h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div style="background: #f5f7fa; border-radius: 10px; padding: 20px; text-align: center; box-shadow: 0 4px 15px rgba(255, 51, 102, 0.1);">
                    <div style="font-size: 2rem; color: #ff3366; margin-bottom: 10px;">
                        <i class="fas fa-eye"></i>
                    </div>
                    <div id="profileViews" style="font-size: 1.8rem; font-weight: bold; color: #333; margin-bottom: 5px;">0</div>
                    <div style="color: #666; font-size: 0.9rem;">Profile Views</div>
                </div>
                
                <div style="background: #f5f7fa; border-radius: 10px; padding: 20px; text-align: center; box-shadow: 0 4px 15px rgba(255, 51, 102, 0.1);">
                    <div style="font-size: 2rem; color: #ff3366; margin-bottom: 10px;">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div id="interestedProfiles" style="font-size: 1.8rem; font-weight: bold; color: #333; margin-bottom: 5px;">0</div>
                    <div style="color: #666; font-size: 0.9rem;">Interested Profiles</div>
                </div>
                
                <div style="background: #f5f7fa; border-radius: 10px; padding: 20px; text-align: center; box-shadow: 0 4px 15px rgba(255, 51, 102, 0.1);">
                    <div style="font-size: 2rem; color: #ff3366; margin-bottom: 10px;">
                        <i class="fas fa-users"></i>
                    </div>
                    <div id="matchSuggestionsCount" style="font-size: 1.8rem; font-weight: bold; color: #333; margin-bottom: 5px;">0</div>
                    <div style="color: #666; font-size: 0.9rem;">Match Suggestions</div>
                </div>
                
                <div style="background: #f5f7fa; border-radius: 10px; padding: 20px; text-align: center; box-shadow: 0 4px 15px rgba(255, 51, 102, 0.1);">
                    <div style="font-size: 2rem; color: #ff3366; margin-bottom: 10px;">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <div id="newMessages" style="font-size: 1.8rem; font-weight: bold; color: #333; margin-bottom: 5px;">0</div>
                    <div style="color: #666; font-size: 0.9rem;">New Messages</div>
                </div>
            </div>
            
            <h3 style="color: #ff3366; margin-bottom: 20px; font-size: 1.5rem; border-bottom: 2px solid #ddd; padding-bottom: 10px;">Recent Activities</h3>
            <div id="recentActivities">
                <!-- Recent activities will be loaded here -->
            </div>
        </div>
        
        <!-- Edit Profile -->
        <div id="profile" class="dashboard-section" style="display: none;">
            <h2 style="color: #ff3366; margin-bottom: 20px; font-size: 1.8rem; border-bottom: 2px solid #ddd; padding-bottom: 10px;">Edit Profile</h2>
            
            <form id="profileForm">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div style="margin-bottom: 20px;">
                        <label for="firstName" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">First Name *</label>
                        <input type="text" id="firstName" name="firstName" required style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; transition: all 0.3s ease;">
                        <div id="firstName-error" style="color: #dc3545; font-size: 12px; margin-top: 5px; display: none;"></div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="lastName" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Last Name *</label>
                        <input type="text" id="lastName" name="lastName" required style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; transition: all 0.3s ease;">
                        <div id="lastName-error" style="color: #dc3545; font-size: 12px; margin-top: 5px; display: none;"></div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="dob" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Date of Birth *</label>
                        <input type="date" id="dob" name="dob" required style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; transition: all 0.3s ease;">
                        <div id="dob-error" style="color: #dc3545; font-size: 12px; margin-top: 5px; display: none;"></div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="gender" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Gender *</label>
                        <select id="gender" name="gender" required style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; transition: all 0.3s ease;">
                            <option value="">Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                        </select>
                        <div id="gender-error" style="color: #dc3545; font-size: 12px; margin-top: 5px; display: none;"></div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="maritalStatus" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Marital Status *</label>
                        <select id="maritalStatus" name="maritalStatus" required style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; transition: all 0.3s ease;">
                            <option value="">Select Marital Status</option>
                            <option value="Never Married">Never Married</option>
                            <option value="Divorced">Divorced</option>
                            <option value="Widowed">Widowed</option>
                            <option value="Separated">Separated</option>
                        </select>
                        <div id="maritalStatus-error" style="color: #dc3545; font-size: 12px; margin-top: 5px; display: none;"></div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="religion" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Religion *</label>
                        <select id="religion" name="religion" required style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; transition: all 0.3s ease;">
                            <option value="">Select Religion</option>
                            <option value="Hindu">Hindu</option>
                            <option value="Muslim">Muslim</option>
                            <option value="Christian">Christian</option>
                            <option value="Sikh">Sikh</option>
                            <option value="Buddhist">Buddhist</option>
                            <option value="Jain">Jain</option>
                            <option value="Other">Other</option>
                        </select>
                        <div id="religion-error" style="color: #dc3545; font-size: 12px; margin-top: 5px; display: none;"></div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="caste" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Caste/Community *</label>
                        <select id="caste" name="caste" required style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; transition: all 0.3s ease;">
                            <option value="">Select Caste/Community</option>
                            <option value="Brahmin">Brahmin</option>
                            <option value="Kshatriya">Kshatriya</option>
                            <option value="Vaishya">Vaishya</option>
                            <option value="Shudra">Shudra</option>
                            <option value="Other">Other</option>
                        </select>
                        <div id="caste-error" style="color: #dc3545; font-size: 12px; margin-top: 5px; display: none;"></div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="subCaste" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Sub Caste (Optional)</label>
                        <input type="text" id="subCaste" name="subCaste" style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; transition: all 0.3s ease;">
                        <div id="subcasteOptions" style="display: none; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; margin-top: 10px;"></div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="motherTongue" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Mother Tongue *</label>
                        <select id="motherTongue" name="motherTongue" required style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; transition: all 0.3s ease;">
                            <option value="">Select Mother Tongue</option>
                            <option value="Hindi">Hindi</option>
                            <option value="Bengali">Bengali</option>
                            <option value="Tamil">Tamil</option>
                            <option value="Telugu">Telugu</option>
                            <option value="Marathi">Marathi</option>
                            <option value="Gujarati">Gujarati</option>
                            <option value="Other">Other</option>
                        </select>
                        <div id="motherTongue-error" style="color: #dc3545; font-size: 12px; margin-top: 5px; display: none;"></div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="education" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Highest Education *</label>
                        <select id="education" name="education" required style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; transition: all 0.3s ease;">
                            <option value="">Select Education Level</option>
                            <option value="High School">High School</option>
                            <option value="Bachelor's Degree">Bachelor's Degree</option>
                            <option value="Master's Degree">Master's Degree</option>
                            <option value="Doctorate">Doctorate</option>
                            <option value="Diploma">Diploma</option>
                            <option value="Other">Other</option>
                        </select>
                        <div id="education-error" style="color: #dc3545; font-size: 12px; margin-top: 5px; display: none;"></div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="college" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">College/University</label>
                        <input type="text" id="college" name="college" style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; transition: all 0.3s ease;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="profession" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Profession *</label>
                        <select id="profession" name="profession" required style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; transition: all 0.3s ease;">
                            <option value="">Select Profession</option>
                            <option value="Software Professional">Software Professional</option>
                            <option value="Doctor">Doctor</option>
                            <option value="Engineer">Engineer</option>
                            <option value="Teacher">Teacher</option>
                            <option value="Business Owner">Business Owner</option>
                            <option value="Government Employee">Government Employee</option>
                            <option value="Private Employee">Private Employee</option>
                            <option value="Student">Student</option>
                            <option value="Other">Other</option>
                        </select>
                        <div id="profession-error" style="color: #dc3545; font-size: 12px; margin-top: 5px; display: none;"></div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="income" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Annual Income (₹) *</label>
                        <select id="income" name="income" required style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; transition: all 0.3s ease;">
                            <option value="">Select Income Range</option>
                            <option value="0-5 Lakhs">0-5 Lakhs</option>
                            <option value="5-10 Lakhs">5-10 Lakhs</option>
                            <option value="10-20 Lakhs">10-20 Lakhs</option>
                            <option value="20-30 Lakhs">20-30 Lakhs</option>
                            <option value="30+ Lakhs">30+ Lakhs</option>
                        </select>
                        <div id="income-error" style="color: #dc3545; font-size: 12px; margin-top: 5px; display: none;"></div>
                    </div>
                    
                    <div style="margin-bottom: 20px; grid-column: 1 / -1;">
                        <label for="aboutMe" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">About Me</label>
                        <textarea id="aboutMe" name="aboutMe" rows="4" placeholder="Tell others about yourself, your interests, and what you're looking for in a partner" style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; transition: all 0.3s ease;"></textarea>
                    </div>
                    
                    <div style="margin-bottom: 20px; grid-column: 1 / -1;">
                        <label for="partnerExpectations" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Partner Expectations</label>
                        <textarea id="partnerExpectations" name="partnerExpectations" rows="4" placeholder="Describe what you're looking for in a life partner" style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; transition: all 0.3s ease;"></textarea>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: flex-end; gap: 15px; margin-top: 30px;">
                    <button type="button" id="cancelBtn" style="background: #4CAF50; color: white; border: none; padding: 15px 30px; border-radius: 50px; font-size: 16px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3); transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 8px;">
                        Cancel
                    </button>
                    <button type="submit" style="background: linear-gradient(135deg, #ff3366, #ff4b2b); color: white; border: none; padding: 15px 30px; border-radius: 50px; font-size: 16px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 15px rgba(255, 51, 102, 0.3); transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 8px;">
                        <i class="fas fa-save"></i> Update Profile
                    </button>
                </div>
            </form>
        </div>
        
        <!-- My Photos -->
        <div id="photos" class="dashboard-section" style="display: none;">
            <h2 style="color: #ff3366; margin-bottom: 20px; font-size: 1.8rem; border-bottom: 2px solid #ddd; padding-bottom: 10px;">My Photos</h2>
            <p style="color: #666; margin-bottom: 20px;">Upload and manage your profile photos. You can add up to 6 photos.</p>
            
            <div id="photoGallery" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; margin-bottom: 30px;">
                <!-- Photos will be loaded here -->
            </div>
            
            <div id="addPhotoBtn" style="border: 2px dashed #ddd; border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #666; cursor: pointer; transition: all 0.3s ease; aspect-ratio: 1; padding: 20px;">
                <i class="fas fa-plus-circle" style="font-size: 2rem; margin-bottom: 10px;"></i>
                <span>Add Photo</span>
            </div>
            
            <input type="file" id="photoUpload" accept="image/*" style="display: none;">
        </div>
        
        <!-- Match Suggestions -->
        <div id="matches" class="dashboard-section" style="display: none;">
            <h2 style="color: #ff3366; margin-bottom: 20px; font-size: 1.8rem; border-bottom: 2px solid #ddd; padding-bottom: 10px;">Match Suggestions</h2>
            <p style="color: #666; margin-bottom: 20px;">Based on your profile and preferences, we've found these potential matches for you.</p>
            
            <div id="matchesContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px;">
                <!-- Match suggestions will be loaded here -->
            </div>
        </div>
        
        <!-- Messages -->
        <div id="messages" class="dashboard-section" style="display: none;">
            <h2 style="color: #ff3366; margin-bottom: 20px; font-size: 1.8rem; border-bottom: 2px solid #ddd; padding-bottom: 10px;">Messages</h2>
            <p style="color: #666; margin-bottom: 20px;">Connect with your matches through our secure messaging system.</p>
            <div id="messagesContainer">
                <!-- Messages will be loaded here -->
            </div>
        </div>
        
        <!-- Settings -->
        <div id="settings" class="dashboard-section" style="display: none;">
            <h2 style="color: #ff3366; margin-bottom: 20px; font-size: 1.8rem; border-bottom: 2px solid #ddd; padding-bottom: 10px;">Account Settings</h2>
            <p style="color: #666; margin-bottom: 20px;">Manage your account preferences and privacy settings.</p>
            <div id="settingsContainer">
                <!-- Settings options will be loaded here -->
            </div>
        </div>
    </div>
</div>

<script>
    // User data
    let userData = {};
    let matchSuggestions = [];
    
    // Subcaste data
    const subcasteData = {
        'Brahmin': ['Iyer', 'Iyengar', 'Kanyakubj', 'Gaur', 'Saraswat', 'Maithil', 'Other'],
        'Kshatriya': ['Rajput', 'Maratha', 'Jat', 'Gurjar', 'Thakur', 'Bhumihar', 'Other'],
        'Vaishya': ['Agarwal', 'Gupta', 'Mahajan', 'Lohana', 'Khatri', 'Baniya', 'Other'],
        'Shudra': ['Yadav', 'Kurmi', 'Koiri', 'Lodh', 'Other'],
        'Other': ['Please specify']
    };

    // DOM elements
    const navLinks = document.querySelectorAll('.nav-link');
    const dashboardSections = document.querySelectorAll('.dashboard-section');
    const profileForm = document.getElementById('profileForm');
    const addPhotoBtn = document.getElementById('addPhotoBtn');
    const photoUpload = document.getElementById('photoUpload');
    const casteSelect = document.getElementById('caste');
    const subcasteOptions = document.getElementById('subcasteOptions');
    const logoutBtn = document.getElementById('logoutBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    
    // Initialize dashboard
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize UI and behavior. Do NOT force-login here — allow guest access.
        setupNavigation();
        setupFormSubmission();
        setupPhotoUpload();
        setupSubcasteOptions();
        logoutBtn.addEventListener('click', logoutUser);
        cancelBtn.addEventListener('click', function() { showSection('dashboard'); });

        // Check auth status but do not redirect; enable guest view when no token
        checkAuthStatus();
    });
    
    // Check authentication status
    function checkAuthStatus() {
        const token = localStorage.getItem('authToken');
        if (!token) {
            // Guest view: allow browsing but disable editing features
            document.getElementById('userName').textContent = 'Guest User';
            document.getElementById('userId').textContent = '';
            logoutBtn.style.display = 'none';

            // Disable profile form inputs and upload controls so guests cannot modify
            if (profileForm) {
                profileForm.querySelectorAll('input, select, textarea, button').forEach(el => {
                    // Keep the Cancel button enabled
                    if (el.id === 'cancelBtn') return;
                    // Keep non-submit buttons (like navigation) enabled
                    if (el.type === 'button') return;
                    el.disabled = true;
                });
            }

            // Show a subtle notice to the user
            const notice = document.createElement('div');
            notice.id = 'guestNotice';
            notice.style.cssText = 'max-width:1200px;margin:70px auto 10px;padding:10px 20px;background:#fff3cd;border:1px solid #ffeeba;color:#856404;border-radius:6px;text-align:center;';
            notice.innerHTML = 'You are viewing as <strong>Guest</strong>. <a href="login2.html">Login</a> to edit your profile and see personalized data.';
            document.body.insertBefore(notice, document.body.children[2]);

            return;
        }

        // If token is present, load user data
        loadUserData();
    }
    
    // Load user data from backend
    function loadUserData() {
        const token = localStorage.getItem('authToken');
        
        fetch('http://localhost:5000/api/user/profile', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to fetch user data');
            }
            return response.json();
        })
        .then(data => {
            if (data.success) {
                userData = data.user;
                populateUserData();
                
                // Load additional data
                loadDashboardStats();
                loadMatchSuggestions();
                loadUserPhotos();
            } else {
                throw new Error(data.message || 'Failed to load user data');
            }
        })
        .catch(error => {
            console.error('Error loading user data:', error);
            alert('Error loading user data: ' + error.message);
        });
    }
    
    // Load dashboard statistics
    function loadDashboardStats() {
        const token = localStorage.getItem('authToken');
        
        fetch('http://localhost:5000/api/user/dashboard-stats', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById('profileViews').textContent = data.stats.profileViews || 0;
                document.getElementById('interestedProfiles').textContent = data.stats.interestedProfiles || 0;
                document.getElementById('matchSuggestionsCount').textContent = data.stats.matchSuggestions || 0;
                document.getElementById('newMessages').textContent = data.stats.newMessages || 0;
            }
        })
        .catch(error => {
            console.error('Error loading dashboard stats:', error);
        });
    }
    
    // Populate user data in the UI
    function populateUserData() {
        document.getElementById('userName').textContent = `${userData.firstName} ${userData.lastName}`;
        document.getElementById('userId').textContent = `ID: ${userData.id || 'HM' + Math.floor(100000 + Math.random() * 900000)}`;
        
        // Populate form fields
        document.getElementById('firstName').value = userData.firstName || '';
        document.getElementById('lastName').value = userData.lastName || '';
        document.getElementById('dob').value = userData.dob || '';
        document.getElementById('gender').value = userData.gender || '';
        document.getElementById('maritalStatus').value = userData.maritalStatus || '';
        document.getElementById('religion').value = userData.religion || '';
        document.getElementById('caste').value = userData.caste || '';
        document.getElementById('subCaste').value = userData.subCaste || '';
        document.getElementById('motherTongue').value = userData.motherTongue || '';
        document.getElementById('education').value = userData.education || '';
        document.getElementById('college').value = userData.college || '';
        document.getElementById('profession').value = userData.profession || '';
        document.getElementById('income').value = userData.income || '';
        document.getElementById('aboutMe').value = userData.aboutMe || '';
        document.getElementById('partnerExpectations').value = userData.partnerExpectations || '';
        
        // Update profile photo if available
        if (userData.profileImage) {
            document.getElementById('profilePhoto').src = userData.profileImage;
        }
        
        // Update subcaste options based on caste
        updateSubcasteOptions(userData.caste);
        
        // Calculate and update profile completion
        updateProfileCompletion();
    }
    
    // Update profile completion percentage
    function updateProfileCompletion() {
        let completedFields = 0;
        const totalFields = 12; // Adjust based on your form fields
        
        // Check each required field
        const requiredFields = [
            'firstName', 'lastName', 'dob', 'gender', 'maritalStatus',
            'religion', 'caste', 'motherTongue', 'education', 'profession', 'income'
        ];
        
        requiredFields.forEach(field => {
            if (userData[field] && userData[field].trim() !== '') {
                completedFields++;
            }
        });
        
        // Check about me (optional but adds to completion)
        if (userData.aboutMe && userData.aboutMe.trim() !== '') {
            completedFields++;
        }
        
        const completionPercentage = Math.round((completedFields / totalFields) * 100);
        document.getElementById('profileProgress').style.width = `${completionPercentage}%`;
        document.getElementById('completionText').textContent = `Profile ${completionPercentage}% Complete`;
    }
    
    // Set up navigation between sections
    function setupNavigation() {
        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remove active class from all links
                navLinks.forEach(l => {
                    l.style.background = '';
                    l.style.color = '#333';
                });
                
                // Add active class to clicked link
                this.style.background = 'rgba(255, 51, 102, 0.1)';
                this.style.color = '#ff3366';
                
                // Hide all sections
                dashboardSections.forEach(section => {
                    section.style.display = 'none';
                });
                
                // Show selected section
                const sectionId = this.getAttribute('data-section');
                showSection(sectionId);
            });
        });
    }
    
    // Show specific section
    function showSection(sectionId) {
        document.getElementById(sectionId).style.display = 'block';
        
        // Load section-specific data
        if (sectionId === 'matches') {
            loadMatchSuggestions();
        } else if (sectionId === 'photos') {
            loadUserPhotos();
        } else if (sectionId === 'messages') {
            loadMessages();
        } else if (sectionId === 'settings') {
            loadSettings();
        }
    }
    
    // Set up form submission
    function setupFormSubmission() {
        profileForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validate form
            if (validateProfileForm()) {
                // Update user data
                updateUserData();
            }
        });
    }
    
    // Validate profile form
    function validateProfileForm() {
        let isValid = true;
        const requiredFields = [
            'firstName', 'lastName', 'dob', 'gender', 'maritalStatus',
            'religion', 'caste', 'motherTongue', 'education', 'profession', 'income'
        ];
        
        // Clear previous errors
        requiredFields.forEach(field => {
            clearError(field);
        });
        
        requiredFields.forEach(field => {
            const element = document.getElementById(field);
            
            if (!element.value) {
                showError(field, 'This field is required');
                isValid = false;
            }
        });
        
        // Validate age
        if (document.getElementById('dob').value) {
            const dob = new Date(document.getElementById('dob').value);
            const today = new Date();
            const age = today.getFullYear() - dob.getFullYear();
            
            if (age < 18) {
                showError('dob', 'You must be at least 18 years old');
                isValid = false;
            }
        }
        
        return isValid;
    }
    
    // Show error message
    function showError(fieldId, message) {
        const errorElement = document.getElementById(`${fieldId}-error`);
        if (errorElement) {
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }
        const inputElement = document.getElementById(fieldId);
        if (inputElement) {
            inputElement.style.borderColor = '#dc3545';
        }
    }
    
    // Clear error message
    function clearError(fieldId) {
        const errorElement = document.getElementById(`${fieldId}-error`);
        if (errorElement) {
            errorElement.style.display = 'none';
        }
        const inputElement = document.getElementById(fieldId);
        if (inputElement) {
            inputElement.style.borderColor = '#ddd';
        }
    }
    
    // Update user data
    function updateUserData() {
        const token = localStorage.getItem('authToken');
        
        // Collect form data
        const formData = new FormData(profileForm);
        const updateData = {};
        
        for (let [key, value] of formData.entries()) {
            updateData[key] = value;
        }
        
        // Show loading state
        const submitBtn = profileForm.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Updating...';
        submitBtn.disabled = true;
        
        fetch('http://localhost:5000/api/user/update-profile', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(updateData)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update userData object
                Object.assign(userData, updateData);
                
                // Update UI
                document.getElementById('userName').textContent = `${userData.firstName} ${userData.lastName}`;
                updateProfileCompletion();
                
                alert('Profile updated successfully!');
                showSection('dashboard');
            } else {
                throw new Error(data.message || 'Failed to update profile');
            }
        })
        .catch(error => {
            console.error('Error updating profile:', error);
            alert('Error updating profile: ' + error.message);
        })
        .finally(() => {
            // Reset button state
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        });
    }
    
    // Set up photo upload
    function setupPhotoUpload() {
        addPhotoBtn.addEventListener('click', function() {
            photoUpload.click();
        });
        
        photoUpload.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                const file = this.files[0];
                
                // Validate file type and size
                if (!file.type.startsWith('image/')) {
                    alert('Please select an image file');
                    return;
                }
                
                if (file.size > 5 * 1024 * 1024) { // 5MB limit
                    alert('Image size should be less than 5MB');
                    return;
                }
                
                // Upload photo to backend
                uploadPhoto(file);
            }
        });
    }
    
    // Upload photo to backend
    function uploadPhoto(file) {
        const token = localStorage.getItem('authToken');
        const formData = new FormData();
        formData.append('photo', file);
        
        fetch('http://localhost:5000/api/user/upload-photo', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`
            },
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Add photo to gallery
                addPhotoToGallery(data.photoUrl);
                
                // If this is the first photo, set it as profile photo
                if (!userData.profileImage) {
                    setAsProfilePhoto(data.photoUrl);
                }
            } else {
                alert('Failed to upload photo: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error uploading photo:', error);
            alert('Error uploading photo');
        });
    }
    
    // Load user photos
    function loadUserPhotos() {
        const token = localStorage.getItem('authToken');
        
        fetch('http://localhost:5000/api/user/photos', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const photoGallery = document.getElementById('photoGallery');
                photoGallery.innerHTML = '';
                
                data.photos.forEach(photo => {
                    addPhotoToGallery(photo.url, photo.id, photo.isProfile);
                });
            }
        })
        .catch(error => {
            console.error('Error loading photos:', error);
        });
    }
    
    // Add photo to gallery
    function addPhotoToGallery(photoUrl, photoId, isProfile = false) {
        const photoGallery = document.getElementById('photoGallery');
        const photoItem = document.createElement('div');
        photoItem.className = 'photo-item';
        photoItem.style.position = 'relative';
        photoItem.style.borderRadius = '10px';
        photoItem.style.overflow = 'hidden';
        photoItem.style.aspectRatio = '1';
        
        photoItem.innerHTML = `
            <img src="${photoUrl}" alt="User Photo" style="width: 100%; height: 100%; object-fit: cover;">
            <div class="photo-actions" style="position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0, 0, 0, 0.7); display: flex; justify-content: space-around; padding: 8px; transform: translateY(100%); transition: transform 0.3s ease;">
                <span class="photo-action set-profile" title="Set as Profile" style="color: white; cursor: pointer; transition: color 0.3s ease;">
                    <i class="fas fa-user-circle"></i>
                </span>
                <span class="photo-action delete-photo" title="Delete" style="color: white; cursor: pointer; transition: color 0.3s ease;">
                    <i class="fas fa-trash"></i>
                </span>
            </div>
            ${isProfile ? '<div style="position: absolute; top: 5px; right: 5px; background: #ff3366; color: white; padding: 2px 5px; border-radius: 3px; font-size: 0.7rem;">Profile</div>' : ''}
        `;
        
        // Add hover effect
        photoItem.addEventListener('mouseenter', function() {
            this.querySelector('.photo-actions').style.transform = 'translateY(0)';
        });
        
        photoItem.addEventListener('mouseleave', function() {
            this.querySelector('.photo-actions').style.transform = 'translateY(100%)';
        });
        
        // Insert before the add photo button
        photoGallery.appendChild(photoItem);
        
        // Add event listeners for photo actions
        const setAsProfileBtn = photoItem.querySelector('.set-profile');
        const deleteBtn = photoItem.querySelector('.delete-photo');
        
        setAsProfileBtn.addEventListener('click', function() {
            setAsProfilePhoto(photoUrl, photoId);
        });
        
        deleteBtn.addEventListener('click', function() {
            deletePhoto(photoId, photoItem);
        });
    }
    
    // Set photo as profile photo
    function setAsProfilePhoto(photoUrl, photoId) {
        const token = localStorage.getItem('authToken');
        
        fetch('http://localhost:5000/api/user/set-profile-photo', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                photoId: photoId
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update profile photo in UI
                document.getElementById('profilePhoto').src = photoUrl;
                userData.profileImage = photoUrl;
                alert('Profile photo updated successfully');
                
                // Reload photos to update profile photo indicators
                loadUserPhotos();
            } else {
                alert('Failed to update profile photo: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error updating profile photo:', error);
            alert('Error updating profile photo');
        });
    }
    
    // Delete photo
    function deletePhoto(photoId, photoElement) {
        if (confirm('Are you sure you want to delete this photo?')) {
            const token = localStorage.getItem('authToken');
            
            // Delete photo from backend
            fetch('http://localhost:5000/api/user/delete-photo', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    photoId: photoId
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Remove photo from gallery
                    photoElement.remove();
                    alert('Photo deleted successfully');
                } else {
                    alert('Failed to delete photo: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error deleting photo:', error);
                alert('Error deleting photo');
            });
        }
    }
    
    // Load match suggestions
    function loadMatchSuggestions() {
        const token = localStorage.getItem('authToken');
        
        fetch('http://localhost:5000/api/user/match-suggestions', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                matchSuggestions = data.matches;
                populateMatchSuggestions();
            }
        })
        .catch(error => {
            console.error('Error loading match suggestions:', error);
        });
    }
    
    // Populate match suggestions in UI
    function populateMatchSuggestions() {
        const matchesContainer = document.getElementById('matchesContainer');
        matchesContainer.innerHTML = '';
        
        if (matchSuggestions.length === 0) {
            matchesContainer.innerHTML = '<p style="text-align: center; color: #666; grid-column: 1 / -1;">No match suggestions found at the moment. Check back later!</p>';
            return;
        }
        
        matchSuggestions.forEach(match => {
            const matchCard = document.createElement('div');
            matchCard.style.background = 'white';
            matchCard.style.borderRadius = '15px';
            matchCard.style.overflow = 'hidden';
            matchCard.style.boxShadow = '0 4px 15px rgba(255, 51, 102, 0.1)';
            matchCard.style.transition = 'transform 0.3s ease';
            
            matchCard.innerHTML = `
                <img src="${match.photo || 'https://via.placeholder.com/250x200?text=Profile+Photo'}" alt="${match.name}" style="width: 100%; height: 200px; object-fit: cover;">
                <div style="padding: 15px;">
                    <h3 style="font-size: 1.2rem; color: #333; margin-bottom: 5px;">${match.name}, ${match.age}</h3>
                    <p style="color: #666; font-size: 0.9rem; margin-bottom: 5px;">${match.profession} • ${match.education}</p>
                    <p style="color: #666; font-size: 0.9rem; margin-bottom: 10px;">${match.location}</p>
                    <div style="color: #ff3366; font-weight: bold; margin-bottom: 10px;">
                        ${match.matchPercentage}% Match
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <button class="btn-interest" data-id="${match.id}" style="background: #ff3366; color: white; border: none; padding: 8px 15px; border-radius: 20px; font-size: 0.8rem; cursor: pointer; transition: all 0.3s ease;">
                            <i class="fas fa-heart"></i> Express Interest
                        </button>
                        <button class="btn-ignore" data-id="${match.id}" style="background: #ddd; color: #333; border: none; padding: 8px 15px; border-radius: 20px; font-size: 0.8rem; cursor: pointer; transition: all 0.3s ease;">
                            <i class="fas fa-times"></i> Ignore
                        </button>
                    </div>
                </div>
            `;
            
            // Add hover effect
            matchCard.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-5px)';
            });
            
            matchCard.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
            
            matchesContainer.appendChild(matchCard);
        });
        
        // Add event listeners to match buttons
        document.querySelectorAll('.btn-interest').forEach(btn => {
            btn.addEventListener('click', function() {
                const matchId = this.getAttribute('data-id');
                expressInterest(matchId);
            });
        });
        
        document.querySelectorAll('.btn-ignore').forEach(btn => {
            btn.addEventListener('click', function() {
                const matchId = this.getAttribute('data-id');
                ignoreMatch(matchId);
            });
        });
    }
    
    // Express interest in a match
    function expressInterest(matchId) {
        const token = localStorage.getItem('authToken');
        
        fetch('http://localhost:5000/api/user/express-interest', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                matchId: matchId
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Interest expressed successfully!');
                // Remove the match card from UI
                document.querySelector(`.btn-interest[data-id="${matchId}"]`).closest('div').parentNode.parentNode.remove();
                
                // Update dashboard stats
                loadDashboardStats();
            } else {
                alert('Failed to express interest: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error expressing interest:', error);
            alert('Error expressing interest');
        });
    }
    
    // Ignore a match
    function ignoreMatch(matchId) {
        const token = localStorage.getItem('authToken');
        
        fetch('http://localhost:5000/api/user/ignore-match', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                matchId: matchId
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Remove the match card from UI
                document.querySelector(`.btn-ignore[data-id="${matchId}"]`).closest('div').parentNode.parentNode.remove();
                alert('Match ignored');
                
                // Update dashboard stats
                loadDashboardStats();
            } else {
                alert('Failed to ignore match: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error ignoring match:', error);
            alert('Error ignoring match');
        });
    }
    
    // Set up subcaste options
    function setupSubcasteOptions() {
        casteSelect.addEventListener('change', function() {
            updateSubcasteOptions(this.value);
        });
    }
    
    // Update subcaste options based on selected caste
    function updateSubcasteOptions(caste) {
        subcasteOptions.innerHTML = '';
        
        if (caste && subcasteData[caste]) {
            subcasteOptions.style.display = 'grid';
            subcasteOptions.style.gridTemplateColumns = 'repeat(auto-fill, minmax(150px, 1fr))';
            subcasteOptions.style.gap = '10px';
            subcasteOptions.style.marginTop = '10px';
            
            subcasteData[caste].forEach(subcaste => {
                const option = document.createElement('div');
                option.className = 'subcaste-option';
                option.textContent = subcaste;
                option.style.padding = '10px';
                option.style.border = '1px solid #ddd';
                option.style.borderRadius = '5px';
                option.style.textAlign = 'center';
                option.style.cursor = 'pointer';
                option.style.transition = 'all 0.3s ease';
                
                option.addEventListener('click', function() {
                    // Remove active class from all options
                    document.querySelectorAll('.subcaste-option').forEach(el => {
                        el.style.background = 'white';
                        el.style.color = '#333';
                    });
                    
                    // Add active class to clicked option
                    this.style.background = '#ff3366';
                    this.style.color = 'white';
                    
                    // Set subcaste value
                    document.getElementById('subCaste').value = this.textContent;
                });
                
                subcasteOptions.appendChild(option);
            });
        } else {
            subcasteOptions.style.display = 'none';
        }
    }
    
    // Load messages
    function loadMessages() {
        const messagesContainer = document.getElementById('messagesContainer');
        messagesContainer.innerHTML = '<p style="text-align: center; color: #666;">Messages feature coming soon!</p>';
    }
    
    // Load settings
    function loadSettings() {
        const settingsContainer = document.getElementById('settingsContainer');
        settingsContainer.innerHTML = '<p style="text-align: center; color: #666;">Settings feature coming soon!</p>';
    }
    
    // Logout user
    function logoutUser() {
        localStorage.removeItem('authToken');
        window.location.href = 'login2.html';
    }
</script>
</body>
</html>